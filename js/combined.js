
var wxApp=wxApp||{};(function(){wxApp.FeatureCollection=Backbone.Collection.extend({model:wxApp.Feature,initialize:function(){console.log('loading feature collection.');}});})();wxApp=wxApp||{};(function($){wxApp.FormBuilderControlCheckboxGroup=Backbone.Collection.extend({model:wxApp.FormBuilderControlCheckbox,initialize:function(){console.log('radio group collection init');this.on('add',this.onAdd);},onAdd:function(checkbox){if(this.length==1){this.firstElementId=checkbox.cid;}
checkbox.set({collectionId:this.firstElementId});}});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FormBuilderCollection=Backbone.Collection.extend({model:wxApp.FormBuilderControl,initialize:function(){console.log(this.toJSONrecursive());this.on('add',this.onAdd);},onAdd:function(){}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlOptionGroup=Backbone.Collection.extend({model:wxApp.FormBuilderControlOption,initialize:function(){console.log('option group collection init');this.on('add',this.onAdd);},onAdd:function(option){if(this.length==1){this.firstElementId=option.cid;}
option.set({collectionId:this.firstElementId});}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRadioGroup=Backbone.Collection.extend({model:wxApp.FormBuilderControlRadio,initialize:function(){console.log('radio group collection init');this.on('add',this.onAdd);},onAdd:function(radio){if(this.length==1){this.firstElementId=radio.cid;}
radio.set({collectionId:this.firstElementId});}});})(jQuery);var wxApp=wxApp||{};(function(){wxApp.SubTabCollection=Backbone.Collection.extend({model:wxApp.SubTab});})();var wxApp=wxApp||{};(function($){wxApp.TabsCollection=Backbone.Collection.extend({model:wxApp.Tab,url:wx.apiUrl+'tabs/get_tabs?site_key='+wx.siteKey,getModelNameByTabData:function(tabData){var retVal='SubTab';switch(tabData.content){case'twitter':retVal='TwitterSubTab';break;case'youtubePlaylist':retVal='YoutubeSubTab';break;case'flickrPhotosets':retVal='FlickrSubTab';break;default:if(tabData.config!=undefined&&tabData.config.subtab_name!=undefined){if(tabData.config.subtab_name in wxApp){retVal=tabData.config.subtab_name;}}
if('SubTab'==retVal){for(var obj in wxApp){if(obj.indexOf('SubTab')!=-1&&undefined!=wxApp[obj].prototype.defaults&&undefined!=wxApp[obj].prototype.defaults.type){if(wxApp[obj].prototype.defaults.type==tabData.type){retVal=obj;break;}}}}
if('SubTab'==retVal){for(var obj in wxApp){if(obj.indexOf('SubTab')!=-1&&undefined!=wxApp[obj].prototype.defaults&&undefined!=wxApp[obj].prototype.defaults.content){if(wxApp[obj].prototype.defaults.content==tabData.content){retVal=obj;break;}}}}}
return retVal;},fetch:function(){console.log('Get tabs.');var me=this;wx.makeApiCall('tabs/get_tabs',{},function(data){console.log('Tabs got.');if(typeof data.tabs!='undefined'){var tabs=[];for(var tabIndex=0;tabIndex<data.tabs.length;tabIndex++){var tabData=data.tabs[tabIndex];if(null===tabData.parent_id){var tab=new wxApp.Tab(tabData);var modelName=me.getModelNameByTabData(tabData);tab.addSubTab(new wxApp[modelName](tabData));for(var i=0;i<data.tabs.length;i++){if(tab.get('id')==data.tabs[i].parent_id){modelName=me.getModelNameByTabData(data.tabs[i]);tab.addSubTab(new wxApp[modelName](data.tabs[i]));}}
tabs.push(tab);}}
me.reset();for(i=0;i<tabs.length;i++)
me.add(tabs[i]);if(me.length)
wx.refreshAppPreview();}});}});wxApp.Tabs=new wxApp.TabsCollection();})(jQuery);var wxApp=wxApp||{};(function($){wxApp.Design=Backbone.Model.extend({defaults:{},fetch:function(onComplete){var me=this;wx.makeApiCall('design/get_design',{},function(data){me.set(data.design);if(typeof onComplete!=='undefined'){onComplete();}})}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.Feature=Backbone.Model.extend({defaults:{featureName:'',imgUri:'',name:'',filterBy:'',rel:'',includeClass:'',visible:true,iconId:0}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderAction=Backbone.Model.extend({defaults:function(){return{control:'action',method:'post',value:'',pdfHeader:{title:'',line1:'',line2:'',line3:''}};},initialize:function(){console.log('FormBuilderAction init');console.log(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlInput=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{control:'input',label:'Label'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlCheckboxFieldset=Backbone.Model.extend({defaults:{control:'checkboxfieldset',title:'Checkbox Fieldset',allowAdditional:'',allowAdditionalClass:''},initialize:function(){this.set('attributes',new wxApp.FormBuilderControlAttributes());this.set('checkboxGroup',new wxApp.FormBuilderControlCheckboxGroup());console.log(this);return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlCheckbox=wxApp.FormBuilderControlInput.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{label:'Checkbox',autocompleteClass:'hide'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);this.get('attributes').set('type','checkbox');}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlInfo=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{control:'div',label:'',innerHTML:''});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlAttributes=Backbone.Model.extend({defaults:{}});wxApp.FormBuilderControl=Backbone.Model.extend({defaults:function(){return{control:'',type:'',label:'',hidePlaceholderClass:'',showPlaceholder:false,innerText:'',allowAdditional:'',allowAdditionalClass:'',valueType:'number',valueClass:'hide',minClass:'hide',maxClass:'hide',stepClass:'hide',multiClass:'hide',requiredClass:'',autocompleteClass:'hide'};},initialize:function(){this.set('attributes',new wxApp.FormBuilderControlAttributes());this.togglePlaceholder();this.on('change:showPlaceholder',this.togglePlaceholder);console.log(this);},togglePlaceholder:function(){if(this.get('showPlaceholder')===false){this.set('hidePlaceholderClass','hide');}}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderLabel=wxApp.FormBuilderControl.extend({defaults:{label:'Label'}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlOption=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{control:'option',label:'Option'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRadioFieldset=Backbone.Model.extend({defaults:{control:'radiofieldset',title:'Radio Fieldset',allowAdditional:'',allowAdditionalClass:''},initialize:function(){this.set('attributes',new wxApp.FormBuilderControlAttributes());this.set('radioGroup',new wxApp.FormBuilderControlRadioGroup());return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRadio=wxApp.FormBuilderControlInput.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{label:'Radio Button',autocompleteClass:'hide'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);this.get('attributes').set('type','radio');console.log(this);console.log(this.cid);console.log(this.collection);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRangeInput=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{input:'range',label:'Label'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlSelect=Backbone.Model.extend({defaults:{control:'select',title:'Dropdown',allowAdditional:'',allowAdditionalClass:''},initialize:function(){this.set('attributes',new wxApp.FormBuilderControlAttributes());this.set('optionGroup',new wxApp.FormBuilderControlOptionGroup());console.log(this);return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlSignature=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{control:'signature',label:'Signature'});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlTextarea=wxApp.FormBuilderControl.extend({defaults:function(){var newDefaults=_.extend(this.constructor.__super__.defaults(),{control:'textarea',label:'Text Area',showPlaceholder:true});return newDefaults;},initialize:function(){wxApp.FormBuilderControl.prototype.initialize.apply(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.BloggerSubTab=wxApp.SubTab.extend({default_icon_id:7,allowedLayouts:['list'],typeDescription:'Blogger',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Blog',icon_id:6,type:'blogger',content:'blogger',layout:'list',config:{blog_url:'http://blogname.blogger.com'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FacebookAlbumsSubTab=wxApp.SubTab.extend({default_icon_id:15,allowedLayouts:['list'],defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Photos',icon_id:15,type:'facebookAlbums',content:'facebookAlbums',layout:'list',config:{url:'http://facebook.com/'}}),typeDescription:'Facebook Photos'});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FacebookEventsSubTab=wxApp.SubTab.extend({default_icon_id:16,allowedLayouts:['list'],typeDescription:'Facebook Events',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Events',icon_id:16,type:'facebookEvents',content:'facebookEvents',layout:'list',config:{url:'http://facebook.com/'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FacebookWallSubTab=wxApp.SubTab.extend({default_icon_id:13,typeDescription:'Facebook Wall',allowedLayouts:['list'],defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Facebook',icon_id:13,type:'facebookWall',content:'facebookStatuses',layout:'list',config:{url:'http://facebook.com/'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FlickrSubTab=wxApp.SubTab.extend({default_icon_id:19,allowedLayouts:['list'],typeDescription:'Flickr',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Flickr',icon_id:19,type:'flickr',content:'flickrPhotostream',layout:'carousel',config:{url:'http://flickr.com/'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderSubTab=wxApp.SubTab.extend({default_icon_id:30,validateFeed:false,typeDescription:'Form Builder',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Formbuilder Title',tabTitle:'Form',icon_id:this.default_icon_id,type:'formbuilder',content:'formbuilder',layout:'panel',config:{}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.FoursquarePhotosSubTab=wxApp.SubTab.extend({default_icon_id:25,allowedLayouts:['list'],typeDescription:'Foursquare',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Photos',icon_id:25,type:'foursquarePhotos',content:'foursquarePhotos',layout:'list',config:{venue_id:'http://foursquare.com/v/'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.GoogleCalendarSubTab=wxApp.SubTab.extend({default_icon_id:7,allowedLayouts:['list'],typeDescription:'Google Calendar',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Calendar',icon_id:7,type:'googleCalendar',content:'googleCalendar',layout:'list',config:{calendar_id:'abc123@group.calendar.google.com'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.SubTab=wxApp.Tab.extend({defaults:{id:null,parent_id:null,title:'',icon_id:1,type:null,layout:null,typeDescription:'',published:1,config:{},featureName:''},typeDescription:'',validateFeed:true,allowTitleEdit:true,initialize:function(){},setConfig:function(key,val){var config=this.getConfig();config[key]=val;try{this.set('config',config);}catch(e){}},deleteConfig:function(key){var config=this.getConfig();delete config[key];this.set('config',config);},getConfig:function(){return this.get('config');},getModelName:function(){var retVal=false;for(var name in wxApp){if(wxApp[name]==this.constructor){retVal=name;break;}}
return retVal;},getAPIData:function(){var data=this.toJSON();data.config=JSON.stringify(data.config);if(data.id==data.parent_id)
delete data['parent_id'];if(data.id)
data.tab_id=data.id;return this.filterAPIData(data);},filterAPIData:function(data){return data;},toJSON:function(){var retVal=JSON.parse(JSON.stringify(this.attributes));retVal.validateFeed=this.validateFeed;retVal.typeDescription=this.typeDescription;return retVal;},getValidateFeed:function(){return true;},save:function(){var me=this;wx.makeApiCall('tabs/add_tab',me.getAPIData(),function(data){if(!me.get('id')){me.set('id',data.tab_id);Backbone.Events.trigger('tab:new',me);}else{me.trigger('save',me);}});},destroy:function(){var me=this;wx.makeApiCall('tabs/delete',{tab_id:this.get('id')},function(){me.trigger('destroy');});}});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.PicasaAlbumsSubTab=wxApp.SubTab.extend({default_icon_id:15,allowedLayouts:['list'],typeDescription:'Picasa Photos',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Photos',icon_id:15,type:'picasaAlbums',content:'picasaAlbums',layout:'list',config:{user_id:'your.email@gmail.com'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.r3sSubTab=wxApp.SubTab.extend({default_icon_id:6,typeDescription:'R3S Feed',allowedLayouts:['list'],defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'R3S Feed',icon_id:6,type:'r3s',content:'htmlR3s',layout:'list',config:{url:'http://yourwebsite.com/?feed=r3s'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.RSSSubTab=wxApp.SubTab.extend({default_icon_id:6,typeDescription:'RSS Feed',allowedLayouts:['list'],defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'RSS Feed',icon_id:6,type:'rss',content:'htmlRss',layout:'list',config:{url:'http://yourwebsite.com/'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.TwitterSubTab=wxApp.SubTab.extend({default_icon_id:21,allowedLayouts:['list'],typeDescription:'Twitter',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Social',icon_id:21,type:'twitterUser',content:'twitterUser',layout:'list',config:{}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.VimeoSubTab=wxApp.SubTab.extend({default_icon_id:35,allowedLayouts:['list'],typeDescription:'Vimeo',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Vimeo',icon_id:35,type:'vimeo',content:'vimeo',layout:'list',config:{url:'http://vimeo.com/user1234'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressBlogSubTab=wxApp.SubTab.extend({default_icon_id:5,allowedLayouts:['list'],typeDescription:'Content: Posts',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Blog',icon_id:5,type:'WordpressBlog',content:'html',layout:'list',config:{subtab_name:'WordpressBlogSubTab'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressCategorySubTab=wxApp.SubTab.extend({default_icon_id:5,allowedLayouts:['list'],typeDescription:'Content: Category',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Blog',icon_id:5,type:'WordpressCategory',content:'html',layout:'list',config:{subtab_name:'WordpressCategorySubTab'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.WordpressContactsSubTab=wxApp.SubTab.extend({default_icon_id:34,allowedLayouts:['list'],typeDescription:'Contact',validateFeed:false,allowTitleEdit:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Contact',icon_id:34,type:'wordpress-contact',content:'contact',layout:'panel',config_cache:{}}),filterAPIData:function(data){data.config_cache=JSON.stringify(this.get('config_cache'));delete data['config'];return data;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressDirectorySubTab=wxApp.SubTab.extend({default_icon_id:11,allowedLayouts:['list'],typeDescription:'Content: Directory',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Directory',icon_id:11,type:'WordpressDirectory',content:'html',layout:'list',config:{subtab_name:'WordpressDirectorySubTab'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressMapSubTab=wxApp.SubTab.extend({default_icon_id:20,allowedLayouts:['list'],typeDescription:'Content: Map',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Map',icon_id:20,type:'WordpressMap',content:'html',layout:'list',tabLayout:'map',config:{url:'',gps:'1',subtab_name:'WordpressMapSubTab'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressPageSubTab=wxApp.SubTab.extend({default_icon_id:28,allowedLayouts:['list'],typeDescription:'Content: Pages',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Pages',icon_id:28,type:'WordpressPage',content:'htmlPage',layout:'panel',config:{url:''}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressProximitySubTab=wxApp.SubTab.extend({default_icon_id:27,allowedLayouts:['list'],typeDescription:'Content: Nearby',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Nearby',icon_id:27,type:'WordpressProximity',content:'html',layout:'list',config:{url:'',gps:'1',geotag:'1',subtab_name:'WordpressProximitySubTab'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressSearchtermSubTab=wxApp.SubTab.extend({default_icon_id:8,allowedLayouts:['list'],typeDescription:'Content: Search Term',validateFeed:false,defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Search',icon_id:8,type:'WordpressSearchterm',content:'html',layout:'list',config:{url:'',subtab_name:'WordpressSearchtermSubTab'}})});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressTagSubTab=wxApp.SubTab.extend({default_icon_id:5,allowedLayouts:['list'],validateFeed:false,typeDescription:'Content: Tag',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Blog',icon_id:5,type:'WordpressTag',content:'html',layout:'list',config:{url:'',subtab_name:'WordpressTagSubTab'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.WufooSubTab=wxApp.SubTab.extend({default_icon_id:30,allowedLayouts:['list'],typeDescription:'Wufoo Forms',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'Forms',icon_id:30,type:'wufoo',content:'wufoo',layout:'list',config:{url:'https://USERNAME.wufoo.com',apikey:'XXXX-XXXX-XXXX-XXXX'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.YoutubeSubTab=wxApp.SubTab.extend({default_icon_id:18,allowedLayouts:['list'],typeDescription:'Youtube',defaults:_.extend({},wxApp.SubTab.prototype.defaults,{title:'YouTube',icon_id:18,type:'youtube',content:'youtube',layout:'list',config:{url:'http://youtube.com/'}})});})(jQuery);var wxApp=wxApp||{};(function($){wxApp.Tab=Backbone.Model.extend({defaults:{id:'',title:'',icon_id:1,subTabs:false},validate:function(attribs){},initialize:function(){var me=this;console.log('This function has been initialized');var subTabs=new wxApp.SubTabCollection();this.set({subTabs:subTabs});this.on('invalid',function(model,error){console.log(error);});this.get('subTabs').on('remove',function(subTab){wx.log('detected subTabs remove event');if(!me.getSubTabs().length)
me.destroy();});},setTitle:function(newTitle){this.set({title:newTitle});},addSubTab:function(subTab){var me=this;subTab.set('parent_id',this.get('id'));this.get('subTabs').add(subTab);subTab.on('tab:move',function(){wx.log('detected tab:move for subtab in Tab model');me.getSubTabs().remove(this);});},deleteSubTab:function(subTab){wx.log('removing sub tab from collection');wx.log(subTab.get('id'));this.get('subTabs').remove(subTab);},getSubTabs:function(){return this.get('subTabs');},destroy:function(){this.trigger('destroy',this);}});})(jQuery);wxApp=wxApp||{};(function($){var escapeJSON=function(key,val){if(typeof val!=='string'){return val;}
var replaced=encodeURIComponent(val);return replaced;};var toJSONrecursive=function(){return JSON.parse(JSON.stringify(this.attributes,escapeJSON));}
var collectionToJSONrecursive=function(){var coll=[];this.models.forEach(function(model){coll.push(model.toJSONrecursive());});return JSON.parse(JSON.stringify(coll));}
Backbone.Model.prototype.toJSONrecursive=toJSONrecursive;Backbone.Collection.prototype.toJSONrecursive=collectionToJSONrecursive;wxApp.App=Backbone.View.extend({el:'#toptabs',initialize:function(){this.allowAddContentButtonsToBeDragged();this.allowDroppingOnAddArea();Backbone.Events.on('api:success',this.highlightAppPreviewRefresh,this);Backbone.Events.on('subtab:dragstart',this.showDropTab,this);Backbone.Events.on('subtab:dragstop',this.hideDropTab,this);Backbone.Events.on('tab:dropped',this.clearBodyStyles,this);Backbone.Events.on('tab:dropped',this.hideDropTab,this);},events:{'click .wx-add-source-icon':'addFeature','click #preview-refresh':'refreshAppPreview'},allowAddContentButtonsToBeDragged:function(){if(undefined!=this.$('list-add-content-items li').draggable){this.$('.list-add-content-items li').draggable({cursor:"move",cursorAt:{top:10,left:10},helper:function(event){return $("<div class='ui-widget-draggable'>"+$(event.delegateTarget).find('span')[0].innerHTML+"</div>");},revert:true});}},allowDroppingOnAddArea:function(){if(undefined!==this.$('#addFeatureID').droppable){this.$('#addFeatureID').droppable({accept:".list-add-content-items li",hoverClass:"ui-state-hover",drop:this.onDropOnAddArea});}},onDropOnAddArea:function(event,ui){wxApp.appView.createFeatureView($(ui.draggable).attr('id').replace('add-',''));},addFeature:function(ev){this.createFeatureView(ev.currentTarget.id.replace('add-',''));},createFeatureView:function(id,parentId){if(undefined!==wxApp[id+'SubTab']&&undefined!==wxApp[id+'SubTabEditView']){var tab=new wxApp[id+'SubTab']();if(undefined!=parentId&&parentId)
tab.set('parent_id',parseInt(parentId));var view=new wxApp[id+'SubTabEditView']({model:tab,el:'#wx-edit-area-'+id});}else{throw new Error('Invalid type '+id);}},highlightAppPreviewRefresh:function(){$('#preview-refresh').effect('pulsate',{times:5},6000);},refreshAppPreview:function(){wx.refreshAppPreview();},showDropTab:function(){$('#dropTab').show();},hideDropTab:function(){$('#dropTab').hide();},clearBodyStyles:function(){$('body').attr('style','');}});wxApp.appView=new wxApp.App();})(jQuery);wxApp=wxApp||{};(function($){wxApp.IconEditView=wxApp.EditView.extend({iconProperty:'icon_id',initialize:function(){console.log('IconEditView init');this.editTpl=_.template($('#icon-edit-template').html());},finish:function(){var me=this;wx.log(this.$('input:radio[name="wx-icon"]').val());var iconId=this.$('input:radio[name="wx-icon"]:checked').val();var tabId=this.model.get('id');wx.makeApiCall('tabs/set_icon_id',{tab_id:tabId,icon_id:iconId},function(){try{$('#SubtabEditModal').foundation('reveal','close');me.model.set('icon_id',iconId);setTimeout(function(){wx.refreshAppPreview();},500);me.remove();}catch(e){}});}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.EditView=Backbone.View.extend({events:{'click button.finish':'finish','click .close-reveal-modal':'cancel'},render:function(){this.$el.html(this.editTpl(this.model.toJSON()));return this;},cancel:function(){try{this.remove();}catch(e){}}})})(jQuery);wxApp=wxApp||{};(function($){wxApp.TitleEditView=wxApp.EditView.extend({initialize:function(){this.editTpl=_.template($('#title-edit-template').html());},finish:function(){var me=this;var title=this.$('#alertName').val();var tabId=this.model.get('id');wx.makeApiCall('tabs/set_tabTitle',{tab_id:tabId,tabTitle:title},function(){try{$('#SubtabEditModal').foundation('reveal','close');me.model.set('tabTitle',title);setTimeout(function(){wx.refreshAppPreview();},500);me.remove();}catch(e){}});}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FeatureView=Backbone.View.extend({tagName:'li',className:'',initialize:function(){this.featureTpl=_.template($('#feature-template').html());this.model.bind('change',this.render,this);},render:function(){this.$el.html(this.featureTpl(this.model.toJSON()));if(this.model.get('rel')!==''){this.$('button').attr('rel',this.model.get('rel'));}
return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FeatureList=Backbone.View.extend({el:'#toptabs',initialize:function(){console.log('initialize feature list view');this.collection=new wxApp.FeatureCollection();this.collection.bind('add',this.addOne,this);},addOne:function(feature){if(feature.get('rel')===''){console.log('addONE');var me=this;var view=new wxApp.FeatureView({model:feature});this.$el.append(view.render().el);}}});wxApp.featureList=new wxApp.FeatureList();wxApp.featureList.collection.fetch({url:'../wp-content/plugins/wp_weeverapps/static/js/config/wx.featurelist.js',success:function(result){console.log('features fetched');},error:function(){console.log('Could not load feature list.')}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderActionView=Backbone.View.extend({className:'wx-form-builder-row',tplSelector:'#form-builder-action',tplEmailSelector:'#form-builder-action-email',events:{'blur .wx-form-builder-action':'updateAction','click .wx-form-builder-delete':'deleteControl','blur .wx-form-builder-pdfheader-title':'updatePdfHeader','blur .wx-form-builder-pdfheader-line1':'updatePdfHeader','blur .wx-form-builder-pdfheader-line2':'updatePdfHeader','blur .wx-form-builder-pdfheader-line3':'updatePdfHeader'},initialize:function(){var tpl=this.tplSelector;if(this.model.get('method')=='email'){tpl=this.tplEmailSelector;}
var $template=$(tpl);this.tpl=_.template($template.html());this.model.bind('change',this.render,this);},render:function(){this.$el.html(this.tpl(this.model.toJSON()));return this;},updatePdfHeader:function(ev){console.log('updatePdfHeader');var $me=$(ev.currentTarget);if($me.hasClass('wx-form-builder-pdfheader-title'))
this.model.get('pdfHeader').title=$me.val();if($me.hasClass('wx-form-builder-pdfheader-line1'))
this.model.get('pdfHeader').line1=$me.val();if($me.hasClass('wx-form-builder-pdfheader-line2'))
this.model.get('pdfHeader').line2=$me.val();if($me.hasClass('wx-form-builder-pdfheader-line3'))
this.model.get('pdfHeader').line3=$me.val();console.log(this.model);},updateAction:function(ev){console.log('updateAction');ev.preventDefault();var $me=$(ev.currentTarget);this.model.set('value',$me.val());console.log(this.model);},deleteControl:function(){console.log('deleteControl');this.remove();this.model.destroy();}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlCheckboxFieldsetView=Backbone.View.extend({tplSelector:'#form-builder-checkbox-fieldset',events:{'click .wx-form-builder-edit-title':'editTitle','blur .wx-form-builder-title-input':'updateTitle','click .wx-form-builder-allow-additional':'setAllowAdditional','click .wx-form-builder-delete':'deleteControl'},initialize:function(){console.log('checkbox fieldset view init');var $template=$(this.tplSelector);this.tpl=_.template($template.html());},render:function(){console.log('checkbox fieldset view render');this.$el.html(this.tpl(this.model.toJSON()));return this;},deleteControl:function(){console.log('deleteControl');this.remove();this.model.destroy();},setAllowAdditional:function(ev){console.log('setAllowAdditional');var $me=$(ev.currentTarget);if($me.is(':checked')){console.log('checked');this.model.set('allowAdditional','checked');}
else{this.model.set('allowAdditional','');}},editTitle:function(ev){console.log('editTitle');ev.preventDefault();this.$title=$(ev.currentTarget);this.$('.wx-form-builder-title-input').val(this.$title.text()).show().select();this.$title.hide();},updateTitle:function(ev){console.log('updateTitle');var $me=$(ev.currentTarget);this.$title.text($me.val()).show();$me.hide();this.model.set('title',$me.val());}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlCheckboxGroupView=Backbone.View.extend({initialize:function(){console.log('checkbox group view init');this.template=_.template($('#form-builder-checkbox-group').html());this.collection.bind('add',this.addOne,this);},render:function(){console.log('checkbox group view render');this.$el.html(this.template());return this;},addOne:function(checkbox){console.log('checkbox group view add');var view=new wxApp.FormBuilderControlInputView({model:checkbox,type:'checkbox'});this.$('.wx-form-builder-checkbox-group').append(view.render().el);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlInfoView=wxApp.FormBuilderControlView.extend({tplSelector:'#form-builder-info',events:function(){return _.extend({},wxApp.FormBuilderControlView.prototype.events,{'blur .wx-form-builder-info':'setInfo'});},initialize:function(){console.log('formbuildercontrolinfoview init');var $template=$(this.tplSelector);this.inputTpl=_.template($template.html());},render:function(){console.log('formbuildercontrolinfoview render');var modelJSON=this.model.toJSON();var inputTpl=this.inputTpl(modelJSON);this.$el.html(inputTpl);return this;},setInfo:function(ev){var $me=$(ev.currentTarget);this.model.set('innerHTML',$me.val());}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlInputView=wxApp.FormBuilderControlView.extend({inputTplSelector:'#form-builder-input',radioTplSelector:'#form-builder-radio',checkboxTplSelector:'#form-builder-checkbox',events:function(){return _.extend({},wxApp.FormBuilderControlView.prototype.events,{'click .wx-form-builder-add-radio':'addRadio','click .wx-form-builder-add-checkbox':'addCheckbox'});},initialize:function(options){console.log(options);options.type=(typeof options.type=='undefined'?'input':options.type);var $template=$(this[options.type+'TplSelector']);this.inputTpl=_.template($template.html());this.model.bind('change',this.render,this);},render:function(){this.$el.html(this.inputTpl(this.model.toJSON()));return this;console.log('input render');},addRadio:function(){console.log('radio view add');console.log(this.model);this.model.collection.add(new wxApp.FormBuilderControlRadio());console.log(this.model.collection);},addCheckbox:function(){console.log('checkbox view add');console.log(this.model);this.model.collection.add(new wxApp.FormBuilderControlCheckbox());console.log(this.model.collection);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlView=Backbone.View.extend({className:'wx-form-builder-row',events:{'click .wx-form-builder-edit-label':'editLabel','blur .wx-form-builder-label-input':'updateLabel','blur .wx-form-builder-placeholder-input':'updatePlaceholder','blur .wx-form-builder-min-input':'setMin','blur .wx-form-builder-max-input':'setMax','blur .wx-form-builder-value-input':'setValue','blur .wx-form-builder-step-input':'setStep','click .wx-form-builder-autocomplete':'setAutocomplete','click .wx-form-builder-control-checked':'setChecked','click .wx-form-builder-control-selected':'setSelected','click .wx-form-builder-allow-multiple':'setMultiple','click .wx-form-builder-allow-additional':'setAllowAdditional','click .wx-form-builder-required':'setRequired','click .wx-form-builder-delete':'deleteControl'},deleteControl:function(){console.log('deleteControl');this.remove();this.model.destroy();},editLabel:function(ev){console.log('editLabel');ev.preventDefault();this.$label=$(ev.currentTarget);this.$('.wx-form-builder-label-input').val(this.$label.text()).show().select();this.$label.hide();},updateLabel:function(ev){console.log('updateLabel');var $me=$(ev.currentTarget);this.$label.text($me.val()).show();$me.hide();this.model.set('label',$me.val());},updatePlaceholder:function(ev){console.log('updatePlaceholder');var $me=$(ev.currentTarget);if($me.val()!=='')
this.model.get('attributes').set('placeholder',$me.val());this.getInput().attr('placeholder',$me.val());},setMin:function(ev){this.model.get('attributes').set('min',$(ev.currentTarget).val());this.getInput().attr('min',$(ev.currentTarget).val());},setMax:function(ev){this.model.get('attributes').set('max',$(ev.currentTarget).val());this.getInput().attr('max',$(ev.currentTarget).val());},setValue:function(ev){this.model.get('attributes').set('value',$(ev.currentTarget).val());this.getInput().val($(ev.currentTarget).val());},setStep:function(ev){this.model.get('attributes').set('step',$(ev.currentTarget).val());this.getInput().attr('step',$(ev.currentTarget).val());},setAutocomplete:function(ev){this.model.get('attributes').set('autocomplete',$(ev.currentTarget).val());},setChecked:function(ev){console.log('setChecked');this.model.collection.models.forEach(function(control){control.get('attributes').unset('checked');});this.model.get('attributes').set('checked','checked');},setSelected:function(ev){console.log('setSelected');this.model.collection.models.forEach(function(control){control.get('attributes').unset('selected');});this.model.get('attributes').set('selected','checked');},setMultiple:function(ev){console.log('setMultiple');var $me=$(ev.currentTarget);if($me.is(':checked')){this.model.get('attributes').set('multiple','checked');}
else{this.model.get('attributes').unset('multiple');}},setAllowAdditional:function(ev){console.log('setAllowAdditional');var $me=$(ev.currentTarget);if($me.is(':checked')){console.log('checked');this.model.set('allowAdditional','checked');}
else{this.model.set('allowAdditional','');}},setRequired:function(ev){console.log('setRequired');var $me=$(ev.currentTarget);if($me.is(':checked')){this.model.get('attributes').set('required','checked');$('span.required').show();}
else{this.model.get('attributes').unset('required');$('span.required').hide();}},getInput:function(){$input=this.$('.wx-form-builder-'+this.model.get('attributes').get('type')+'-input');if($input.length==0){$input=this.$('.wx-form-builder-textarea');}
return $input;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlOptionGroupView=Backbone.View.extend({initialize:function(){console.log('option group view init');this.template=_.template($('#form-builder-option-group').html());console.log(this);this.collection.bind('add',this.addOne,this);},render:function(){console.log('option group view render');this.$el.html(this.template());return this;},addOne:function(option){console.log('option group view add');var view=new wxApp.FormBuilderControlOptionView({model:option});this.$('.wx-form-builder-option-group').append(view.render().el);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlOptionView=wxApp.FormBuilderControlView.extend({events:function(){return _.extend({},wxApp.FormBuilderControlView.prototype.events,{'click .wx-form-builder-add-select-option':'addOption','blur .wx-form-builder-select-option-text':'updateOptionText','blur .wx-form-builder-select-option-value':'updateOptionValue'});},initialize:function(){this.selectTpl=_.template($('#form-builder-select-option').html());},render:function(){console.log('select view render');this.$el.html(this.selectTpl(this.model.toJSON()));return this;},addOption:function(){console.log('select view add');this.model.collection.add(new wxApp.FormBuilderControlOption());console.log(this.model.collection);},updateOptionText:function(ev){var $me=$(ev.currentTarget);this.model.set({innerText:$me.val()});console.log(this.model.toJSONrecursive());},updateOptionValue:function(ev){var $me=$(ev.currentTarget);if($me.val()!='')
this.model.get('attributes').set('value',$me.val());}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRadioFieldsetView=Backbone.View.extend({tplSelector:'#form-builder-radio-fieldset',events:{'click .wx-form-builder-edit-title':'editTitle','blur .wx-form-builder-title-input':'updateTitle','click .wx-form-builder-allow-additional':'setAllowAdditional','click .wx-form-builder-delete':'deleteControl'},initialize:function(){console.log('Radio fieldset view init');var $template=$(this.tplSelector);this.tpl=_.template($template.html());},render:function(){console.log('Radio fieldset view render');this.$el.html(this.tpl(this.model.toJSON()));return this;},deleteControl:function(){console.log('deleteControl');this.remove();this.model.destroy();},setAllowAdditional:function(ev){console.log('setAllowAdditional');var $me=$(ev.currentTarget);if($me.is(':checked')){console.log('checked');this.model.set('allowAdditional','checked');}
else{this.model.set('allowAdditional','');}},editTitle:function(ev){console.log('editTitle');ev.preventDefault();this.$title=$(ev.currentTarget);this.$('.wx-form-builder-title-input').val(this.$title.text()).show().select();this.$title.hide();},updateTitle:function(ev){console.log('updateTitle');var $me=$(ev.currentTarget);this.$title.text($me.val()).show();$me.hide();this.model.set('title',$me.val());}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlRadioGroupView=Backbone.View.extend({initialize:function(){console.log('radio group view init');this.template=_.template($('#form-builder-radio-group').html());this.collection.bind('add',this.addOne,this);},render:function(){this.$el.html(this.template());return this;},addOne:function(radio){var view=new wxApp.FormBuilderControlInputView({model:radio,type:'radio'});this.$('.wx-form-builder-radio-group').append(view.render().el);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlSelectView=Backbone.View.extend({tplSelector:'#form-builder-select',events:{'click .wx-form-builder-edit-title':'editTitle','blur .wx-form-builder-title-input':'updateTitle','click .wx-form-builder-select-allow-multiple':'toggleMultipleSelections','click .wx-form-builder-allow-additional':'setAllowAdditional','click .wx-form-builder-delete':'deleteControl'},initialize:function(){console.log('select group view init');var $template=$(this.tplSelector);this.tpl=_.template($template.html());},render:function(){console.log('select group view render');this.$el.html(this.tpl(this.model.toJSON()));return this;},deleteControl:function(){console.log('deleteControl');this.remove();this.model.destroy();},setAllowAdditional:function(ev){console.log('setAllowAdditional');var $me=$(ev.currentTarget);if($me.is(':checked')){console.log('checked');this.model.set('allowAdditional','checked');}
else{this.model.set('allowAdditional','');}},toggleMultipleSelections:function(ev){var $me=$(ev.currentTarget);if($me.is(':checked')){this.model.get('attributes').set('multiple','checked');}
else{this.model.get('attributes').unset('multiple');}},editTitle:function(ev){console.log('editTitle');ev.preventDefault();this.$title=$(ev.currentTarget);this.$('.wx-form-builder-title-input').val(this.$title.text()).show().select();this.$title.hide();},updateTitle:function(ev){console.log('updateTitle');var $me=$(ev.currentTarget);this.$title.text($me.val()).show();$me.hide();this.model.set('title',$me.val());}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlSignatureView=wxApp.FormBuilderControlView.extend({tplSelector:'#form-builder-signature',events:function(){return _.extend({},wxApp.FormBuilderControlView.prototype.events,{});},initialize:function(){var $template=$(this.tplSelector);this.inputTpl=_.template($template.html());this.model.bind('change',this.render,this);},render:function(){this.$el.html(this.inputTpl(this.model.toJSON()));return this;console.log('input render');}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderControlTextareaView=wxApp.FormBuilderControlView.extend({initialize:function(){this.inputTpl=_.template($('#form-builder-textarea').html());this.model.bind('change',this.render,this);},render:function(){this.$el.html(this.inputTpl(this.model.toJSON()));return this;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.InstallIcon=Backbone.View.extend({el:'#install_icon',events:{'click #save_install_icon':'save'},initialize:function(){this.tpl=_.template($('#install-icon').html());this.$('.content').html(this.tpl(this.model.toJSON()));},save:function(){console.log('install icon: save clicked');$('#save_install_icon').html('Saving...');wxApp.design.get('install').prompt=$('#install_prompt').val();wxApp.design.get('install').name=$('#title').val();wxApp.design.get('install').icon=wx.cleanUrl($('#wx-icon_live').attr('src'));var innerParams=JSON.stringify(wxApp.design.get('install'));var params={install:innerParams};wx.makeApiCall('design/set_install',params,function(data){$('#save_install_icon').html('Saved!');});}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.LaunchScreen=Backbone.View.extend({el:'#launch_screen',events:{'click #save_launch_screen':'save'},initialize:function(){this.tpl=_.template($('#launch-screen').html());this.$('.content').html(this.tpl(this.model.toJSON()));},save:function(){console.log('launch screen: save clicked');$('#save_launch_screen').html('Saving...');wxApp.design.get('launchscreen').phone=wx.cleanUrl($('#wx-phone_load_live').attr('src'));wxApp.design.get('launchscreen').tablet=wx.cleanUrl($('#wx-tablet_load_live').attr('src'));wxApp.design.get('launchscreen').tablet_landscape=wx.cleanUrl($('#wx-tablet_landscape_load_live').attr('src'));var innerParams=JSON.stringify(wxApp.design.get('launchscreen'));var params={launchscreen:innerParams};wx.makeApiCall('design/set_launchscreen',params,function(data){$('#save_launch_screen').html('Saved!');setTimeout(function(){wx.refreshAppPreview();},500);});}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.LogoDesign=Backbone.View.extend({el:'#logo_design',events:{'click #save_logo_design':'save','change #titlebarSource':'dropDownChange'},initialize:function(){console.log('Design view init');this.tpl=_.template($('#logo-design').html());this.$('.content').html(this.tpl(this.model.toJSON()));},save:function(){console.log('logo design: save clicked');$('#save_logo_design').html('Saving...');var requestOneSuccess=false;var requestTwoSuccess=false;$.ajax({type:"POST",url:ajaxurl,data:{action:'ajaxSaveTheme',nonce:$('input#nonce').val(),main_titlebar_color:$('#main_titlebar_color').val(),main_titlebar_text_color:$('#main_titlebar_text_color').val(),subtab_color:$('#subtab_color').val(),subtab_text_color:$('#subtab_text_color').val()},success:function(msg){console.log('OK');requestOneSuccess=true;if(requestTwoSuccess){$('#save_logo_design').html('Saved!');setTimeout(function(){wx.refreshAppPreview();},500);}},error:function(v,msg){alert(msg);}});wxApp.design.get('titlebar').html=$('#titlebar_html').val();wxApp.design.get('titlebar').text=$('#titlebar_title').val();wxApp.design.get('titlebar').type=$('#titlebarSource').val();wxApp.design.get('titlebar').image=$('#titlebar_logo_live').attr('src');var innerParams=JSON.stringify(wxApp.design.get('titlebar'));var params={titlebar:innerParams};wx.makeApiCall('design/set_titlebar',params,function(data){requestTwoSuccess=true;if(requestOneSuccess){$('#save_logo_design').html('Saved!');setTimeout(function(){wx.refreshAppPreview();},500);}});},dropDownChange:function(){console.log('logo design: drop down changed');switch($('#titlebarSource').val()){case'text':$('#logoText').show();$('#logoHtml').hide();$('#logoImage').hide();break;case'image':$('#logoText').hide();$('#logoHtml').hide();$('#logoImage').show();break;case'html':$('#logoText').hide();$('#logoHtml').show();$('#logoImage').hide();break;}}});wxApp.design=new wxApp.Design();wxApp.design.fetch(function(){wxApp.logoDesign=new wxApp.LogoDesign({model:wxApp.design});wxApp.launchSreen=new wxApp.LaunchScreen({model:wxApp.design});wxApp.launchSreen=new wxApp.InstallIcon({model:wxApp.design});});})(jQuery);wxApp=wxApp||{};(function($){wxApp.BloggerSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#blogger-subtab-edit-template',setModelFromView:function(model){console.log('Set Model From View');console.log(this.$('.wx-edit-input'));if(this.$('.wx-edit-input'))
model.setConfig('blog_url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.SubTabEditView=Backbone.View.extend({className:'wx-subtab-edit',subTabEditTplSelector:'#subtab-edit-template',subTabEditHeaderTplSelector:'#subtab-edit-header-template',subTabEditFooterTplSelector:'#subtab-edit-footer-template',feedSampleTplSelector:'#feedsample-template',parentContainerId:false,initialize:function(options){this.initializeEvents();this.subTabEditTpl=_.template($(this.subTabEditTplSelector).html());this.subTabEditHeaderTpl=_.template($(this.subTabEditHeaderTplSelector).html());this.subTabEditFooterTpl=_.template($(this.subTabEditFooterTplSelector).html());this.feedSampleTpl=_.template($(this.feedSampleTplSelector).html());this.render();Backbone.Events.on('tab:new',this.destroyView,this);this.model.on('save',this.destroyView,this);},initializeEvents:function(){this.events=this.genericEvents;this.delegateEvents();},genericEvents:{'change .wx-dialog-input':'hideValidateFeed','keydown .wx-dialog-input':'hideValidateFeed','click .wx-finish-button':'finish','click .wx-next-button':'next','change .wx-content-radio':'contentChange'},render:function(){wx.log('render');this.$el.html('<form>'+this.subTabEditTpl(this.model.toJSON())+'</form>');this.$el.prepend(this.subTabEditHeaderTpl(this.model.toJSON()));this.$el.append(this.subTabEditFooterTpl(this.model.toJSON()));this.startValidation();if(this.model.validateFeed){this.$('.wx-finish-button').hide();this.$('.wx-edit-title-div').hide();}else{this.$('.wx-next-button').hide();if(!this.model.allowTitleEdit)
this.$('.wx-edit-title-div').hide();}
return this;},startValidation:function(){if(undefined!==this.$('form').validate){this.$('form').validate();}},contentChange:function(ev){this.hideValidateFeed();this.changeDescriptions();},changeDescriptions:function(){},setParentViewContainerId:function(containerId){this.parentContainerId=containerId;},finish:function(){console.log('Finish clicked.');this.setModelFromView(this.model);this.setTitleFromView(this.model);this.saveModel();$('.reveal-modal').foundation('reveal','close');setTimeout(function(){wx.refreshAppPreview();},500);},next:function(){console.log('next');this.$('#dialog-loader').show();if(undefined!==this.$('form')&&undefined!=this.$('form').validate){validator=this.$('form').validate();if(this.$('form').valid()){this.validateFeed();}else{alert('Error count: '+validator.errorList.length);}}else{this.validateFeed();}},saveModel:function(){this.model.save();},setTitleFromView:function(model){if(model.allowTitleEdit&&this.$('.wx-edit-title'))
model.set('title',this.$('.wx-edit-title').val());return model;},setModelFromView:function(model){},validateFeed:function(){console.log('validate feed');var me=this;var modelCopy=this.getModelCopy();this.setModelFromView(modelCopy);this.getFeedSample(modelCopy,function(response){me.checkFeedSample(response);});},getModelCopy:function(){console.log('get model copy');var modelCopy=$.extend(true,{},this.model);return modelCopy;},checkFeedSample:function(feedSample){if(typeof feedSample!='undefined'&&feedSample.success&&typeof feedSample.feed!='undefined'){this.$('#dialog-loader').hide();this.$('.wx-feed-error').hide();this.displayFeedSample(feedSample);this.$('.wx-next-button').hide();this.$('.wx-finish-button').show();if(this.model.allowTitleEdit)
this.$('.wx-edit-title-div').show();}else
this.$('.wx-feed-error').show();},displayFeedSample:function(feedSample){var me=this;this.$('.wx-validate-feed').show();wx.log('displayFeedSample ***');wx.log(feedSample);if(!feedSample.feed.length){this.$('.wx-validate-feed').html('No content added yet?');}else{this.$('.wx-validate-feed').html('<ul></ul>');for(var index=0;index<feedSample.feed.length;index++){this.$('.wx-validate-feed ul').append(me.feedSampleTpl(feedSample.feed[index]));}}},hideValidateFeed:function(){this.$('.wx-feed-error').hide();this.$('.wx-validate-feed').hide().html('');this.$('.wx-next-button').show();this.$('.wx-finish-button').hide();this.$('.wx-edit-title-div').hide();},getFeedSample:function(model,callback){console.log('get feed sample');var data=model.getAPIData();data.api_check=1;data.confirm_feed=1;$.ajax({url:wx.apiUrl+'validator/validate_feed?site_key='+wx.siteKey,datatype:'JSON',data:data,success:function(response){callback(response);}});},destroyView:function(){try{$('.reveal-modal').foundation('reveal','close');}catch(e){}
this.undelegateEvents();this.$el.removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FacebookAlbumsSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#facebookalbums-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-social-input'))
model.setConfig('url',this.$('.wx-social-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FacebookEventsSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#facebookevents-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-social-input'))
model.setConfig('url',this.$('.wx-social-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FacebookWallSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#facebookwall-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-social-input'))
model.setConfig('url',this.$('.wx-social-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FlickrSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#flickr-subtab-edit-template',setModelFromView:function(model){model.set('content',this.$('.wx-content-radio:checked').val());var url=this.$('.wx-edit-input').val();url=url.replace(/\/$/,'');model.setConfig('url',url);return model;},initializeEvents:function(){this.events=_.extend({},this.genericEvents,this.events);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FormBuilderSubTabEditView=wxApp.SubTabEditView.extend({previewPaneSelector:'.wx-form-builder-preview',subTabEditTplSelector:'#form-builder-subtab-edit-template',initializeEvents:function(){this.events=_.extend({},this.genericEvents,this.events);},initialize:function(){this.constructor.__super__.initialize.apply(this,arguments);console.log('FormBuilderSubTabEditView initialize');if(this.model.get('config').formElements==undefined){this.model.get('config').formElements=new wxApp.FormBuilderCollection();}else{console.log(this.model.get('config').formElements);var elementsJson=JSON.parse(this.model.get('config').formElements);this.model.get('config').formElements=new wxApp.FormBuilderCollection();for(var i=elementsJson.length-1;i>=0;i--){if(elementsJson[i].control==='div'){this.addInfoWithProperties(elementsJson[i]);}else if(elementsJson[i].control==='signature'){this.addSignature();}else if(elementsJson[i].control==='textarea'){this.addTextareaWithProperties(elementsJson[i]);}else if(elementsJson[i].control==='radiofieldset'){this.addRadioGroupWithProperties(elementsJson[i]);}else if(elementsJson[i].control==='checkboxfieldset'){this.addCheckboxGroupWithProperties(elementsJson[i]);}else if(elementsJson[i].control==='select'){this.addSelectWithProperties(elementsJson[i]);}else{this.addInput(elementsJson[i]);}};}},setModelFromView:function(model){console.log('setModelFromView');console.log(model.toJSON());return model;},events:{'click .wx-form-builder-add-text-input':'addTextInput','click .wx-form-builder-add-password-input':'addPasswordInput','click .wx-form-builder-add-date-input':'addDateInput','click .wx-form-builder-add-datetime-local-input':'addDateTimeLocalInput','click .wx-form-builder-add-email-input':'addEmailInput','click .wx-form-builder-add-file-input':'addFileInput','click .wx-form-builder-add-month-input':'addMonthInput','click .wx-form-builder-add-number-input':'addNumberInput','click .wx-form-builder-add-tel-input':'addTelInput','click .wx-form-builder-add-time-input':'addTimeInput','click .wx-form-builder-add-url-input':'addUrlInput','click .wx-form-builder-add-radio-group':'addRadioGroup','click .wx-form-builder-add-checkbox-group':'addCheckboxGroup','click .wx-form-builder-add-textarea':'addTextarea','click .wx-form-builder-add-range-input':'addRangeInput','click .wx-form-builder-add-select':'addSelect','click .wx-form-builder-add-info':'addInfo','click .wx-form-builder-add-signature':'addSignature','click .wx-form-builder-add-custom-action':'addCustomAction','click .wx-form-builder-add-email-action':'addEmailAction'},addEmailAction:function(){console.log('addEmailAction');var action=this.addCustomAction({method:'email'});return action;},addCustomAction:function(customAction){console.log('addCustomAction');var action=new wxApp.FormBuilderAction();if(typeof customAction=='object'){action.set(customAction);}
var actionView=new wxApp.FormBuilderActionView({model:action});this.$(this.previewPaneSelector).append(actionView.render().el);this.model.get('config').formElements.push(action);return action;},addInput:function(properties){var mainProperties={};var attributes={};for(var propKey in properties){if(propKey!='attributes'){mainProperties[propKey]=properties[propKey];}
else{for(var attrKey in properties[propKey]){attributes[attrKey]=properties[propKey][attrKey];}}}
var input=new wxApp.FormBuilderControlInput(mainProperties);input.get('attributes').set(attributes);var inputView=new wxApp.FormBuilderControlInputView({model:input});this.$(this.previewPaneSelector).append(inputView.render().el);this.model.get('config').formElements.push(input);return input;},addDateInput:function(){this.addInput({label:'Date',attributes:{type:'date'}});},addDateTimeLocalInput:function(){this.addInput({label:'Date/Time',attributes:{type:'datetime-local'}});},addEmailInput:function(){this.addInput({label:'Email',showPlaceholder:true,multiClass:'',attributes:{type:'email'}});},addFileInput:function(){this.addInput({label:'File',multiClass:'',autocompleteClass:'hide',attributes:{type:'file',accept:'image/*'}});},addMonthInput:function(){this.addInput({label:'Month',attributes:{type:'month'}});},addNumberInput:function(){this.addInput({label:'Number',minClass:'',maxClass:'',stepClass:'',valueClass:'',attributes:{type:'number'}});},addPasswordInput:function(){this.addInput({label:'Password',attributes:{type:'password'}});},addRangeInput:function(){this.addInput({label:'Range',minClass:'',maxClass:'',stepClass:'',valueClass:'',attributes:{type:'range'}});},addTelInput:function(){this.addInput({label:'Telephone',showPlaceholder:true,attributes:{type:'tel'}});},addTextInput:function(){this.addInput({label:'Text',type:'text',showPlaceholder:true,valueType:'text',valueClass:'',attributes:{type:'text'}});},addTimeInput:function(){this.addInput({label:'Time',attributes:{type:'time'}});},addUrlInput:function(){this.addInput({label:'URL',showPlaceholder:true,attributes:{type:'url'}});},addInfo:function(event){this.addInfoWithProperties({});},addInfoWithProperties:function(properties){var info=new wxApp.FormBuilderControlInfo(properties);var infoView=new wxApp.FormBuilderControlInfoView({model:info});this.$(this.previewPaneSelector).append(infoView.render().el);this.model.get('config').formElements.push(info);},addSignature:function(){var signature=new wxApp.FormBuilderControlSignature();var signatureView=new wxApp.FormBuilderControlSignatureView({model:signature});this.$(this.previewPaneSelector).append(signatureView.render().el);this.model.get('config').formElements.push(signature);},addTextarea:function(){this.addTextareaWithProperties({});},addTextareaWithProperties:function(properties){var textArea=new wxApp.FormBuilderControlTextarea(properties);var textAreaView=new wxApp.FormBuilderControlTextareaView({model:textArea});this.$(this.previewPaneSelector).append(textAreaView.render().el);this.model.get('config').formElements.push(textArea);},addRadioGroup:function(){this.addRadioGroupWithProperties({});},addRadioGroupWithProperties:function(properties){var radioFieldset=new wxApp.FormBuilderControlRadioFieldset(properties);var radioFieldsetView=new wxApp.FormBuilderControlRadioFieldsetView({model:radioFieldset});this.$(this.previewPaneSelector).append(radioFieldsetView.render().el);var radioGroupView=new wxApp.FormBuilderControlRadioGroupView({collection:radioFieldset.get('radioGroup')});radioFieldsetView.$('.wx-form-builder-radio-fieldset').append(radioGroupView.render().el);if(properties.radioGroup==undefined||properties.radioGroup.length==0){radioFieldset.get('radioGroup').add(new wxApp.FormBuilderControlRadio());}else{for(var i=properties.radioGroup.length-1;i>=0;i--){var option=new wxApp.FormBuilderControlRadio(properties.radioGroup[i]);radioFieldset.get('radioGroup').add(option);};}
this.model.get('config').formElements.push(radioFieldset);},addCheckboxGroup:function(){this.addCheckboxGroupWithProperties({});},addCheckboxGroupWithProperties:function(properties){var checkboxFieldset=new wxApp.FormBuilderControlCheckboxFieldset();var checkboxFieldsetView=new wxApp.FormBuilderControlCheckboxFieldsetView({model:checkboxFieldset});this.$(this.previewPaneSelector).append(checkboxFieldsetView.render().el);var checkboxGroupView=new wxApp.FormBuilderControlCheckboxGroupView({collection:checkboxFieldset.get('checkboxGroup')});checkboxFieldsetView.$('.wx-form-builder-checkbox-fieldset').append(checkboxGroupView.render().el);if(properties.checkboxGroup==undefined||properties.checkboxGroup.length==0){checkboxFieldset.get('checkboxGroup').add(new wxApp.FormBuilderControlCheckbox());}else{for(var i=properties.checkboxGroup.length-1;i>=0;i--){var option=new wxApp.FormBuilderControlCheckbox(properties.checkboxGroup[i]);checkboxFieldset.get('checkboxGroup').add(option);};}
this.model.get('config').formElements.push(checkboxFieldset);},addSelect:function(){this.addSelectWithProperties({});},addSelectWithProperties:function(properties){var select=new wxApp.FormBuilderControlSelect();var selectView=new wxApp.FormBuilderControlSelectView({model:select});this.$(this.previewPaneSelector).append(selectView.render().el);var optionGroupView=new wxApp.FormBuilderControlOptionGroupView({collection:select.get('optionGroup')});selectView.$('.wx-form-builder-select').append(optionGroupView.render().el);console.log(properties);if(properties.optionGroup==undefined||properties.optionGroup.length==0){select.get('optionGroup').add(new wxApp.FormBuilderControlOption());}else{for(var i=properties.optionGroup.length-1;i>=0;i--){var option=new wxApp.FormBuilderControlOption(properties.optionGroup[i]);select.get('optionGroup').add(option);};}
this.model.get('config').formElements.push(select);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.FoursquarePhotosSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#foursquarephotos-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.GoogleCalendarSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#googlecalendar-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('calendar_id',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.SubTabView=wxApp.TabView.extend({tagName:'li',className:'wx-ui-row',attributes:function(){return{id:this.model.get('id')+'SubtabID'}},initialize:function(){this.subTabTpl=_.template($('#subtab-template').html());var me=this;this.model.on('save',function(){me.render()});this.model.on('destroy',function(){me.remove();});this.model.on('tab:move',function(){me.remove();});},events:{'click .wx-edit-link':'editSubTab','click .wx-edit-subtab-icon':'editIcon','click .wx-subtab-delete':'confirmDeleteSubTab'},render:function(){this.$el.html(this.subTabTpl(this.model.toJSON()));this.$el.data('backbone-view',this);return this;},editSubTab:function(event){event.preventDefault();var editViewName=this.model.getModelName()+'EditView';if('SubTabEditView'!=editViewName&&undefined!==wxApp[editViewName])
var view=new wxApp[editViewName]({model:this.model,el:'#wx-edit-area-'+this.model.get('id')});else
throw new Error('Invalid edit type '+this.model.get('content')+'--'+editViewName);},confirmDeleteSubTab:function(event){event.preventDefault();if(confirm('Are you sure you want to delete this item?'))
this.deleteSubTab();},deleteSubTab:function(){this.model.destroy();setTimeout(function(){wx.refreshAppPreview();},500);},editIcon:function(){console.log('editing icon...');this.editIconView=new wxApp.IconEditView({model:this.model});this.$('#wx-edit-area-'+this.model.get('id')).html(this.editIconView.render().el);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.PicasaAlbumsSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#picasaalbums-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.r3sSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#r3s-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.RSSSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#rss-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.TwitterSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#twitter-subtab-edit-template',setModelFromView:function(model){var content=this.$('.wx-content-radio:checked').val();if('twitterUser'==content){model.setConfig('screen_name',this.$('.wx-edit-input').val());model.deleteConfig('q');}else{model.setConfig('q',this.$('.wx-edit-input').val());model.deleteConfig('screen_name');}
try{model.set('content',content);}catch(e){;}
return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.VimeoSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#vimeo-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressBlogSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpressblog-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-blog-select'))
model.setConfig('url',this.$('.wx-add-wordpress-blog-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressCategorySubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpresscategory-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-category-select'))
model.setConfig('url',this.$('.wx-add-wordpress-category-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressContactsSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpresscontacts-subtab-edit-template',setModelFromView:function(model){var contact={};if(this.$('.wx-contact-input-title'))
model.set('title',this.$('.wx-contact-input-title').val());if(this.$('.wx-contact-input-phone'))
contact['telephone']=this.$('.wx-contact-input-phone').val();if(this.$('.wx-contact-input-email'))
contact['email_to']=this.$('.wx-contact-input-email').val();if(this.$('.wx-contact-input-address'))
contact['address']=this.$('.wx-contact-input-address').val();if(this.$('.wx-contact-input-town'))
contact['town']=this.$('.wx-contact-input-town').val();if(this.$('.wx-contact-input-state'))
contact['state']=this.$('.wx-contact-input-state').val();if(this.$('.wx-contact-input-country'))
contact['country']=this.$('.wx-contact-input-country').val();contact['googlemaps']=(this.$('.wx-contact-input-googlemaps')&&this.$('.wx-contact-input-googlemaps').val()?1:0);contact['emailform']=(this.$('.wx-contact-input-emailform')&&this.$('.wx-contact-input-emailform').val()?1:0);if(this.$('.wx-contact-input-misc'))
contact['misc']=this.$('.wx-contact-input-misc').val();if(this.$('.wx-contact-input-image')){contact['image']=this.$('.wx-contact-input-image').val();contact['showimage']=(contact['image'].trim()?1:0);}
var config_cache={};var contacts=[];contacts.push(contact);config_cache['contacts']=contacts;try{model.set('config_cache',config_cache);}catch(e){;}
return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressDirectorySubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpressdirectory-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-directory-select'))
model.setConfig('url',this.$('.wx-add-wordpress-directory-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressMapSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpressmap-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-map-select'))
model.setConfig('url',this.$('.wx-add-wordpress-map-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressPageSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpresspage-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-page-select'))
model.setConfig('url',this.$('.wx-add-wordpress-page-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressProximitySubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpressproximity-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-proximity-select'))
model.setConfig('url',this.$('.wx-add-wordpress-proximity-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressSearchtermSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpresssearchterm-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-wordpress-siteurl').val()+'&s='+encodeURIComponent(this.$('.wx-edit-input').val()));return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WordpressTagSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wordpresstag-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-add-wordpress-tag-select'))
model.setConfig('url',this.$('.wx-add-wordpress-tag-select').find(':selected').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.WufooSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#wufoo-subtab-edit-template',setModelFromView:function(model){if(this.$('.wx-edit-input'))
model.setConfig('url',this.$('.wx-edit-input').val());if(this.$('.wx-wufoo-api-key-input'))
model.setConfig('apikey',this.$('.wx-wufoo-api-key-input').val());return model;}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.YoutubeSubTabEditView=wxApp.SubTabEditView.extend({subTabEditTplSelector:'#youtube-subtab-edit-template',setModelFromView:function(model){model.set('content',this.$('.wx-content-radio:checked').val());model.setConfig('url',this.$('.wx-edit-input').val());return model;},initializeEvents:function(){this.events=_.extend({},this.genericEvents,this.events);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.SubTabsView=Backbone.View.extend({tagName:'ul',className:'list-items-sortable list-items list-sub-items',attributes:function(){return{id:'listItemsSortable'+this.model.get('id')}},initialize:function(){var me=this;this.subTabTpl=_.template($('#subtab-template').html());this.model.get('subTabs').bind('add',me.addSubTab,me);Backbone.Events.on('tab:dropped',this.cancelSort,this);},events:{},render:function(){this.$el.html('');this.startSortable();if(this.model.getSubTabs().length){var me=this;this.model.getSubTabs().forEach(function(subTab){me.addSubTab(subTab);});}
return this;},addSubTab:function(subTab){var me=this;var view=new wxApp.SubTabView({model:subTab});this.$el.append(view.render().el);subTab.on('destroy',function(){me.deleteSubTab(this);});this.refreshSortable();},startSortable:function(){var me=this;if(undefined!=this.$el.sortable){this.$el.sortable({start:function(event,ui){Backbone.Events.trigger('subtab:dragstart');},stop:function(event,ui){Backbone.Events.trigger('subtab:dragstop');},update:function(event,ui){var order=String(jQuery(this).sortable('toArray').map(function(element){return element.replace('SubtabID','');}));wx.makeApiCall('tabs/sort_tabs',{order:order},function(){me.setSubTabCollectionOrder(order.split(','));var firstTabId=order.split(',')[0];var mainTabId=$(ui.item).data('backbone-view').model.get('parent_id');if(mainTabId!=firstTabId)
Backbone.Events.trigger('tab:id-update',mainTabId,firstTabId);});},helper:'clone',cursor:'move',cursorAt:{top:31,left:292}});}},setSubTabCollectionOrder:function(order){this.model.get('subTabs').comparator=function(subTab){return order.indexOf(String(subTab.get('id')));}
this.model.get('subTabs').sort();},refreshSortable:function(){if(undefined!=this.$el.sortable)
this.$el.sortable('refresh');},cancelSort:function(tabId){var me=this;if(undefined!=this.$el.sortable&&tabId==this.model.get('id')){me.$el.sortable('cancel');}},deleteSubTab:function(subTab){this.model.deleteSubTab(subTab);}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.SubTabsContainerView=Backbone.View.extend({tagName:'div',className:'wx-tabs-stdcontainer wxui-stdContainer',tabView:false,initialize:function(){var me=this;this.subTabContainerTpl=_.template($('#subtab-container-template').html());this.subTabsView=new wxApp.SubTabsView({model:this.model});this.subTabsView.on('delete',function(){me.model.destroy();me.remove();});this.model.on('change',this.render,this);console.log('done initializing subtabscontainerview');},events:{'click .wx-nav-icon-edit':'iconEdit','click .wx-nav-title-edit':'titleEdit','click .wx-nav-layout-edit':'layoutEdit'},render:function(){wx.log('RENDERING subtabs container');this.$el.html(this.subTabContainerTpl(this.model));this.$('.adminlist').html(this.subTabsView.render().el);this.$el.attr('id',this.model.get('id')+'Tab');return this;},iconEdit:function(){console.log('editing icon...');this.editIconView=new wxApp.IconEditView({model:this.model});this.$('#SubtabEditModal').html(this.editIconView.render().el);},titleEdit:function(){console.log('editing title...');this.editTitleView=new wxApp.TitleEditView({model:this.model});this.$('#SubtabEditModal').html(this.editTitleView.render().el);},layoutEdit:function(){this.tabView.editLayout();}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.TabView=Backbone.View.extend({tagName:'div',className:'wx-tab',subTabsContainerView:false,initialize:function(){this.tabTpl=_.template($('#tab-template').html());this.iconTpl=_.template($('#icon-edit-template').html());this.model.bind('change',this.render,this);this.model.bind('destroy',this.destroyView,this);Backbone.Events.on('tab:id-update',this.updateTabId,this);},events:{'click':'editAll'},render:function(){this.$el.html(this.tabTpl(this.model.toJSON()));this.loadIcon();if(undefined!==this.$el.droppable){this.$el.droppable({accept:".list-sub-items li, .list-add-content-items li",hoverClass:"ui-state-hover",drop:this.onDrop});}
this.$el.data('backbone-view',this);this.$el.attr('id',this.model.get('id')+'TabID');return this;},onDrop:function(event,ui){var me=$(this).data('backbone-view');var draggedItemView=$(ui.draggable).data('backbone-view');if(ui.draggable.hasClass('wx-add-source-icon')){var featureName=ui.draggable.attr('id').replace('add-','');var tabId=me.model.get('id');wxApp.appView.createFeatureView(featureName,tabId);}else{Backbone.Events.trigger('tab:dropped',draggedItemView.model.get('parent_id'));if(draggedItemView.model.get('parent_id')!=me.model.get('id')){wx.makeApiCall('tabs/set_parent_id',{tab_id:draggedItemView.model.get('id'),parent_id:me.model.get('id')},function(){draggedItemView.model.trigger('tab:move');me.model.addSubTab(draggedItemView.model);$('#'+me.model.get('id')+'TabID').click();});}}
var lastStyleTag=$('style')[$('style').length-1];if(lastStyleTag.innerHTML.indexOf('*{ cursor')==0)
lastStyleTag.remove();},editAll:function(){$('a[href="#panel2"]').click();this.subTabsContainerView=new wxApp.SubTabsContainerView({model:this.model});this.subTabsContainerView.tabView=this;$('#editSpace').html(this.subTabsContainerView.render().el);},updateTabId:function(currentTabId,newTabId){if(currentTabId==this.model.get('id')){this.model.getSubTabs().forEach(function(subTab){subTab.set('parent_id',newTabId);});this.model.set('id',newTabId);}},loadIcon:function(){var me=this;$.get(wx.apiUrl+'icons/get_icon_base64',{site_key:wx.siteKey,icon_id:parseInt(me.model.get('icon_id'))},function(iconData){me.$('.wx-nav-icon-img').attr('src','data:image/png;base64,'+iconData);});},destroyView:function(){wx.log('destroying tab view');if(this.subTabsContainerView)
this.subTabsContainerView.remove();this.remove();}});})(jQuery);wxApp=wxApp||{};(function($){wxApp.TabsView=Backbone.View.extend({initialize:function(){this.collection.bind('add',this.addOne,this);this.collection.bind('remove',this.removeOne,this);Backbone.Events.on('tab:new',this.addNewlyCreatedTab,this);this.startTabs();this.startSortable();this.refreshUiTabs();},addOne:function(tab){wx.log('addOne called');var me=this;var view=new wxApp.TabView({model:tab});this.$el.append(view.render().el);view.subTabsContainerView=new wxApp.SubTabsContainerView({model:tab});view.subTabsContainerView.tabView=view;tab.on('destroy',function(tab){wx.log('removing tab from collection');me.removeTabFromCollection(tab);});tab.on('change',this.refreshUiTabs,this);$('#listTabs').append(view.subTabsContainerView.render().el);this.refreshUiTabs();},startTabs:function(){if(undefined!=$('#listTabs').tabs){$("#listTabs").tabs({select:function(e,ui){jQuery('#wxuia-header-parentMenu li').removeClass('wxuia-selected');if(ui.tab.href.indexOf('addTab')!=-1){jQuery('#addtabspan').show();jQuery('#addtabspan').css('display','block');jQuery('#edittabspan').hide();jQuery('#wxuia-header-parentMenu li:first').addClass('wxuia-selected');}else{jQuery('#addtabspan').hide();jQuery('#edittabspan').show();jQuery('#edittabspan').css('display','block');jQuery('#wxuia-header-parentMenu li:nth-child(2)').addClass('wxuia-selected');}}});}},startSortable:function(){var me=this;if(undefined!=this.$el.sortable){this.$el.sortable({axis:"x",cancel:'.wx-nosort',update:function(event,ui){var order=$(this).sortable('toArray');order=$.map(order,function(element){var tabId=element.toLowerCase().replace('tabid','');if($.isNumeric(tabId))
return tabId;else
return null;});wx.makeApiCall('tabs/sort_tabs',{order:String(order)},function(){});if($(ui.item).attr('rel')!='unpublished')
$(ui.item).removeAttr('style');else
$(ui.item).attr('style','float:right;');}});}},refreshUiTabs:function(){if(undefined!=$('#listTabs').tabs){$('#listTabs').tabs('refresh');}},removeOne:function(tab){wx.log('removeOne called (tabs view)');$('#listTabs').tabs('refresh');},addNewlyCreatedTab:function(model){if(model.get('parent_id'))
this.addNewSubTab(model);else
this.addNewMainTab(model);},addNewMainTab:function(model){var tab=new wxApp.Tab(model.getAPIData());tab.addSubTab(model);this.addTabToCollection(tab);},addNewSubTab:function(model){var tab=wxApp.Tabs.get(model.get('parent_id'));if(tab)
tab.addSubTab(model);else
throw new Error('No main tab with id'+model.get('parent_id'));},addTabToCollection:function(tab){wxApp.Tabs.add(tab);},removeTabFromCollection:function(tab){wxApp.Tabs.remove(tab);}});wxApp.BuildTabsView=wxApp.TabsView.extend({el:'#buildListTabsSortable'});wxApp.EditTabsView=wxApp.TabsView.extend({el:'#editListTabsSortable'});wxApp.buildTabsView=new wxApp.BuildTabsView({collection:wxApp.Tabs});wxApp.editTabsView=new wxApp.EditTabsView({collection:wxApp.Tabs});wxApp.Tabs.fetch();})(jQuery);